<head>
	<title>simpleRTS</title>
	<link rel="stylesheet" type="text/css" href="client/style.css">
</head>

<div id="loginScreenDiv">
	<div id="gameNameDiv">
		simpleRTS
	</div>
	<div id="enterNameDiv">
		Your name
		<input id="nameInput" type="text"></input><br>
		<button id="loginButton">Login</button>
	</div>
</div>

<div id="lobbyScreenDiv">
	<div id="lobbyHeaderDiv">
		simpleRTS
		<button id="logoutButton">Logout</button>
	</div>
	<div id="gamesListContainerDiv">
		<b>Open games (click to join)</b>
		<button id="openRoomButton">Create new game</button>
	</div>
	<div id="lobbyChatContainerDiv">
		<b>&nbsp;Chat</b>
		<div id="lobbyChatDiv"></div>
		<input id="lobbyChatInput" type="text" placeholder="Enter your message"></input>
	</div>
	<div id="playersListContainerDiv">
		<b>All players</b>
		<div id="playersListDiv"></div>
	</div>
</div>

<div id="roomScreenDiv">
	<div id="roomHeaderDiv">
		simpleRTS
		<button id="backToLobbyButton">Back to lobby</button>
	</div>
</div>

<div id="gameDiv">
	<canvas id="ctx" width="500" height="500" style="border:1px solid #000000;"></canvas>
</div>

<script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>

<script>
	var socket = io();
	var selfId = null;
	window.onbeforeunload = function() {
		socket.disconnect(); 
	}
	
	var ctx = document.getElementById("ctx").getContext("2d");
	var loginScreenDiv = document.getElementById("loginScreenDiv");
	var nameInput = document.getElementById("nameInput");
	var loginButton = document.getElementById("loginButton");
	
	var lobbyScreenDiv = document.getElementById("lobbyScreenDiv");
	var openRoomButton = document.getElementById("openRoomButton");
	var logoutButton = document.getElementById("logoutButton");
	var lobbyChatDiv = document.getElementById("lobbyChatDiv");
	var lobbyChatInput = document.getElementById("lobbyChatInput");
	var playersListDiv = document.getElementById("playersListDiv");
	
	var roomScreenDiv = document.getElementById("roomScreenDiv");
	var backToLobbyButton = document.getElementById("backToLobbyButton");
	
	
	var gameDiv = document.getElementById("gameDiv");
	
	loginButton.onclick = function(){
		loginScreenDiv.style.display = 'none';
		lobbyScreenDiv.style.display = 'block';
		socket.emit('joinedLobby',{name:nameInput.value});
	}
	
	logoutButton.onclick = function(){
		lobbyScreenDiv.style.display = 'none';
		loginScreenDiv.style.display = 'block';
		socket.emit('leftLobby');
	}
	
	openRoomButton.onclick = function(){
		lobbyScreenDiv.style.display = 'none';
		roomScreenDiv.style.display = 'block';
	}
	
	lobbyChatInput.onkeyup = function(e){
		if(e.keyCode === 13){
			socket.emit('lobbyChatMessage',{id:selfId,message:lobbyChatInput.value});
			lobbyChatInput.value = '';
		}
	};
	
	backToLobbyButton.onclick = function(){
		roomScreenDiv.style.display = 'none';
		lobbyScreenDiv.style.display = 'block';
	}
	
	
	
	socket.on('selfId',function(data){
		selfId = data;
	});
	
	socket.on('lobbyPlayersListUpdate',function(data){
		playersListDiv.innerHTML = "";
		for(var i = 0; i < data.length; i++){
			var player = data[i];
			if (player.id === selfId){
				playersListDiv.innerHTML += '<b>' + player.name + '</b><br>';
			} else {
				playersListDiv.innerHTML += player.name + '<br>';
			}
		}
	});
	
	socket.on('lobbyChatMessageToDisplay',function(data){
		lobbyChatDiv.innerHTML += '<div>' + data + '</div>';
		lobbyChatDiv.scrollTop = lobbyChatDiv.scrollHeight;
	});
	
	
	socket.on('newPositions',function(data){
		ctx.clearRect(0,0,500,500);
		for(var i = 0; i < data.length; i++)
			ctx.fillText(data[i].number,data[i].x,data[i].y);
	});
	
	document.onkeydown = function(event){
		if(event.keyCode === 68) // d
			socket.emit('keyPress',{inputId:'right',state:true});
		else if(event.keyCode === 83) // s
			socket.emit('keyPress',{inputId:'down',state:true});
		else if(event.keyCode === 65) // a
			socket.emit('keyPress',{inputId:'left',state:true});
		else if(event.keyCode === 87) // w
			socket.emit('keyPress',{inputId:'up',state:true});
	}
	document.onkeyup = function(event){
		if(event.keyCode === 68) // d
			socket.emit('keyPress',{inputId:'right',state:false});
		else if(event.keyCode === 83) // s
			socket.emit('keyPress',{inputId:'down',state:false});
		else if(event.keyCode === 65) // a
			socket.emit('keyPress',{inputId:'left',state:false});
		else if(event.keyCode === 87) // w
			socket.emit('keyPress',{inputId:'up',state:false});
	}
</script>